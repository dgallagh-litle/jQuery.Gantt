(function(a,b){"use strict";a.fn.gantt=function(e){var i="jquery.fn.gantt";var h=["hours","days","weeks","months"];var f={source:[],itemsPerPage:7,months:["January","February","March","April","May","June","July","August","September","October","November","December"],dow:["S","M","T","W","T","F","S"],navigate:"buttons",scale:"days",useCookie:false,maxScale:"months",minScale:"hours",waitText:"Please wait...",onItemClick:function(j){return},onAddClick:function(j){return},onRender:function(){return},scrollToToday:true,showFractionalHours:false};if(e){a.extend(f,e)}f.useCookie=f.useCookie&&a.isFunction(a.cookie);a.extend(a.expr[":"],{findday:function(k,o,j){var p=new Date(parseInt(j[3],10));var q=a(k).attr("id");q=q?q:"";var n=q.indexOf("-")+1;var l=new Date(parseInt(q.substring(n,q.length),10));p=new Date(p.getFullYear(),p.getMonth(),p.getDate());l=new Date(l.getFullYear(),l.getMonth(),l.getDate());return p.getTime()===l.getTime()}});a.extend(a.expr[":"],{findweek:function(k,o,j){var p=new Date(parseInt(j[3],10));var q=a(k).attr("id");q=q?q:"";var n=q.indexOf("-")+1;p=p.getFullYear()+"-"+p.getDayForWeek().getWeekOfYear();var l=q.substring(n,q.length);return p===l}});a.extend(a.expr[":"],{findmonth:function(k,o,j){var p=new Date(parseInt(j[3],10));p=p.getFullYear()+"-"+p.getMonth();var q=a(k).attr("id");q=q?q:"";var n=q.indexOf("-")+1;var l=q.substring(n,q.length);return p===l}});Date.prototype.getWeekId=function(){var l=this.getFullYear();var k=this.getDayForWeek().getWeekOfYear();var j=this.getMonth();if(j===11&&k===1){l++}return"dh-"+l+"-"+k};Date.prototype.getRepDate=function(){switch(f.scale){case"hours":return this.getTime();case"weeks":return this.getDayForWeek().getTime();case"months":return new Date(this.getFullYear(),this.getMonth(),1).getTime();default:return this.getTime()}};Date.prototype.getDayOfYear=function(){var j=new Date(this.getFullYear(),0,0);var k=new Date(this.getFullYear(),this.getMonth(),this.getDate());return Math.ceil((k-j)/86400000)};Date.prototype.getWeekOfYear=function(){var k=new Date(this.getFullYear(),0,1);var l=new Date(this.getFullYear(),this.getMonth(),this.getDate());if(k.getDay()>3){k=new Date(l.getFullYear(),0,(7-k.getDay()))}var j=l.getDayOfYear()-k.getDayOfYear();return Math.ceil(j/7)};Date.prototype.getDaysInMonth=function(){return 32-new Date(this.getFullYear(),this.getMonth(),32).getDate()};Date.prototype.hasWeek=function(){var k=new Date(this.valueOf());k.setDate(k.getDate()-k.getDay());var j=new Date(this.valueOf());j.setDate(j.getDate()+(6-j.getDay()));if(k.getMonth()===j.getMonth()){return true}else{return(k.getMonth()===this.getMonth()&&j.getDate()<4)||(k.getMonth()!==this.getMonth()&&j.getDate()>=4)}};Date.prototype.getDayForWeek=function(){var k=new Date(this.valueOf());k.setDate(k.getDate()-k.getDay());var j=new Date(this.valueOf());j.setDate(j.getDate()+(6-j.getDay()));if((k.getMonth()===j.getMonth())||(k.getMonth()!==j.getMonth()&&j.getDate()>=4)){return new Date(j.setDate(j.getDate()-3))}else{return new Date(k.setDate(k.getDate()+3))}};function c(k,l){for(var j=1;;j++){var m=new Date(k);m.setHours(k.getHours()+l*j);if(m.getTime()!==k.getTime()){return m}}}var d={elementFromPoint:(function(){if(document.compatMode==="CSS1Compat"){return function(j,k){j-=window.pageXOffset;k-=window.pageYOffset;return document.elementFromPoint(j,k)}}return function(j,k){j-=a(document).scrollLeft();k-=a(document).scrollTop();return document.elementFromPoint(j,k)}})(),create:function(j){if(typeof f.source!=="string"){j.data=f.source;d.init(j)}else{a.getJSON(f.source,function(k){j.data=k;d.init(j)})}},init:function(j){j.rowsNum=j.data.length;j.pageCount=Math.ceil(j.rowsNum/f.itemsPerPage);j.rowsOnLastPage=j.rowsNum-(Math.floor(j.rowsNum/f.itemsPerPage)*f.itemsPerPage);j.dateStart=g.getMinDate(j);j.dateEnd=g.getMaxDate(j);d.waitToggle(j,true,function(){d.render(j)})},render:function(m){var n=a('<div class="fn-content"/>');var j=d.leftPanel(m);n.append(j);var l=d.rightPanel(m,j);var q,k;n.append(l);n.append(d.navigation(m));var p=l.find(".dataPanel");m.gantt=a('<div class="fn-gantt" />').append(n);a(m).empty().append(m.gantt);m.scrollNavigation.panelMargin=parseInt(p.css("margin-left").replace("px",""),10);m.scrollNavigation.panelMaxPos=(p.width()-l.width());m.scrollNavigation.canScroll=(p.width()>l.width());d.markNow(m);d.fillData(m,p,j);if(f.useCookie){var o=a.cookie(this.cookieKey+"ScrollPos");if(o){m.hPosition=o}}if(f.scrollToToday){d.navigateTo(m,"now");d.scrollPanel(m,0)}else{if((m.hPosition!==0)){if(m.scaleOldWidth){q=(p.width()-l.width());k=q*m.hPosition/m.scaleOldWidth;k=k>0?0:k;p.css({"margin-left":k+"px"});m.scrollNavigation.panelMargin=k;m.hPosition=k;m.scaleOldWidth=null}else{p.css({"margin-left":m.hPosition+"px"});m.scrollNavigation.panelMargin=m.hPosition}d.repositionLabel(m)}else{d.repositionLabel(m)}}p.css({height:j.height()});d.waitToggle(m,false);f.onRender()},leftPanel:function(l){var k=a('<div class="leftPanel"/>').append(a('<div class="row spacer"/>').css("height",g.getCellSize()*l.headerRows+"px").css("width","100%"));var j=[];a.each(l.data,function(m,n){if(m>=l.pageNum*f.itemsPerPage&&m<(l.pageNum*f.itemsPerPage+f.itemsPerPage)){j.push('<div class="row name row'+m+(n.desc?"":" fn-wide")+'" id="rowheader'+m+'" offset="'+m%f.itemsPerPage*g.getCellSize()+'">');j.push('<span class="fn-label'+(n.cssClass?" "+n.cssClass:"")+'">'+n.name+"</span>");j.push("</div>");if(n.desc){j.push('<div class="row desc row'+m+' " id="RowdId_'+m+'" data-id="'+n.id+'">');j.push('<span class="fn-label'+(n.cssClass?" "+n.cssClass:"")+'">'+n.desc+"</span>");j.push("</div>")}}});k.append(j.join(""));return k},dataPanel:function(l,m){var j=a('<div class="dataPanel" style="width: '+m+'px;"/>');var k="onwheel" in l?"wheel":document.onmousewheel!==b?"mousewheel":"DOMMouseScroll";a(l).on(k,function(n){d.wheelScroll(l,n)});j.click(function(s){s.stopPropagation();var u,t;var q=a(l).find(".fn-gantt .leftPanel");var r=a(l).find(".fn-gantt .dataPanel");switch(f.scale){case"weeks":t=g.getCellSize()*2;break;case"months":t=g.getCellSize();break;case"hours":t=g.getCellSize()*4;break;case"days":t=g.getCellSize()*3;break;default:t=g.getCellSize()*2;break}var o=d.elementFromPoint(s.pageX,r.offset().top+t);if(o.className==="fn-label"){o=a(o.parentNode)}else{o=a(o)}var n=o.attr("repdate");var v=d.elementFromPoint(q.offset().left+q.width()-10,s.pageY);if(v.className.indexOf("fn-label")===0){v=a(v.parentNode)}else{v=a(v)}var p=v.data().id;f.onAddClick(n,p)});return j},rightPanel:function(k,G){var x=null;var A=["sn","wd","wd","wd","wd","wd","sa"];var z=['<div class="row"/>'];var J=0;var y=['<div class="row"/>'];var j=0;var t=[];var l=0;var D=[];var w=[];var H=new Date();H=new Date(H.getFullYear(),H.getMonth(),H.getDate());switch(f.scale){case"hours":x=g.parseTimeRange(k.dateStart,k.dateEnd,k.scaleStep);var v=x[0].getFullYear();var I=x[0].getMonth();var C=x[0];for(var E=0,F=x.length;E<F;E++){var B=x[E];var o=B.getFullYear();if(o!==v){z.push(('<div class="row header year" style="width: '+g.getCellSize()*J+'px;"><div class="fn-label">'+v+"</div></div>"));v=o;J=0}J++;var u=B.getMonth();if(u!==I){y.push(('<div class="row header month" style="width: '+g.getCellSize()*j+'px"><div class="fn-label">'+f.months[I]+"</div></div>"));I=u;j=0}j++;var r=B.getDay();var p=C.getDay();var q=A[r];if(g.isHoliday(B)){q="holiday"}if(r!==p){var n=(H-C===0)?"today":g.isHoliday(C.getTime())?"holiday":A[p];t.push('<div class="row date '+n+'"  style="width: '+g.getCellSize()*l+'px;">  <div class="fn-label">'+C.getDate()+"</div></div>");D.push('<div class="row day '+n+'"  style="width: '+g.getCellSize()*l+'px;">  <div class="fn-label">'+f.dow[p]+"</div></div>");C=B;l=0}l++;w.push('<div class="row day dh '+q+'" id="dh-'+B.getTime()+'"  offset="'+E*g.getCellSize()+'" repdate="'+B.getRepDate()+'"><div class="fn-label">'+B.getHours()+"</div></div>")}z.push('<div class="row header year" style="width: '+g.getCellSize()*J+'px;"><div class="fn-label">'+v+"</div></div>");y.push('<div class="row header month" style="width: '+g.getCellSize()*j+'px"><div class="fn-label">'+f.months[I]+"</div></div>");var q=A[C.getDay()];if(g.isHoliday(C)){q="holiday"}t.push('<div class="row date '+q+'"  style="width: '+g.getCellSize()*l+'px;">  <div class="fn-label">'+C.getDate()+"</div></div>");D.push('<div class="row day '+q+'"  style="width: '+g.getCellSize()*l+'px;">  <div class="fn-label">'+f.dow[C.getDay()]+"</div></div>");var m=d.dataPanel(k,x.length*g.getCellSize());m.append(z.join(""));m.append(y.join(""));m.append(a('<div class="row"/>').html(t.join("")));m.append(a('<div class="row"/>').html(D.join("")));m.append(a('<div class="row"/>').html(w.join("")));break;case"weeks":x=g.parseWeeksRange(k.dateStart,k.dateEnd);z=['<div class="row"/>'];y=['<div class="row"/>'];var v=x[0].getFullYear();var I=x[0].getMonth();var C=x[0];for(var E=0,F=x.length;E<F;E++){var B=x[E];if(B.getFullYear()!==v){z.push(('<div class="row header year" style="width: '+g.getCellSize()*J+'px;"><div class="fn-label">'+v+"</div></div>"));v=B.getFullYear();J=0}J++;if(B.getMonth()!==I){y.push(('<div class="row header month" style="width:'+g.getCellSize()*j+'px;"><div class="fn-label">'+f.months[I]+"</div></div>"));I=B.getMonth();j=0}j++;t.push('<div class="row day wd dh"  id="'+B.getWeekId()+'" offset="'+E*g.getCellSize()+'" repdate="'+B.getRepDate()+'">  <div class="fn-label">'+B.getWeekOfYear()+"</div></div>")}z.push('<div class="row header year" style="width: '+g.getCellSize()*J+'px;"><div class="fn-label">'+v+"</div></div>");y.push('<div class="row header month" style="width: '+g.getCellSize()*j+'px"><div class="fn-label">'+f.months[I]+"</div></div>");var m=d.dataPanel(k,x.length*g.getCellSize());m.append(z.join("")+y.join("")+t.join("")+(D.join("")));break;case"months":x=g.parseMonthsRange(k.dateStart,k.dateEnd);var v=x[0].getFullYear();var I=x[0].getMonth();var C=x[0];for(var E=0,F=x.length;E<F;E++){var B=x[E];if(B.getFullYear()!==v){z.push(('<div class="row header year" style="width: '+g.getCellSize()*J+'px;"><div class="fn-label">'+v+"</div></div>"));v=B.getFullYear();J=0}J++;y.push('<div class="row day wd dh" id="dh-'+g.genId(B.getTime())+'" offset="'+E*g.getCellSize()+'" repdate="'+B.getRepDate()+'">'+(1+B.getMonth())+"</div>")}z.push('<div class="row header year" style="width: '+g.getCellSize()*J+'px;"><div class="fn-label">'+v+"</div></div>");y.push('<div class="row header month" style="width: '+g.getCellSize()*j+'px"><div class="fn-label">'+f.months[I]+"</div></div>");var m=d.dataPanel(k,x.length*g.getCellSize());m.append(z.join(""));m.append(y.join(""));m.append(a('<div class="row"/>').html(t.join("")));m.append(a('<div class="row"/>').html(D.join("")));break;default:x=g.parseDateRange(k.dateStart,k.dateEnd);var s=c(x[0],-1);var v=s.getFullYear();var I=s.getMonth();var C=s;for(var E=0,F=x.length;E<F;E++){var B=x[E];if(B.getFullYear()!==v){z.push(('<div class="row header year" style="width:'+g.getCellSize()*J+'px;"><div class="fn-label">'+v+"</div></div>"));v=B.getFullYear();J=0}J++;if(B.getMonth()!==I){y.push(('<div class="row header month" style="width:'+g.getCellSize()*j+'px;"><div class="fn-label">'+f.months[I]+"</div></div>"));I=B.getMonth();j=0}j++;var p=B.getDay();var q=A[p];if(g.isHoliday(B)){q="holiday"}t.push('<div class="row date '+q+'"  id="dh-'+g.genId(B.getTime())+'" offset="'+E*g.getCellSize()+'" repdate="'+B.getRepDate()+'">  <div class="fn-label">'+B.getDate()+"</div></div>");D.push('<div class="row day '+q+'"  id="dw-'+g.genId(B.getTime())+'"  repdate="'+B.getRepDate()+'">  <div class="fn-label">'+f.dow[p]+"</div></div>")}z.push('<div class="row header year" style="width: '+g.getCellSize()*J+'px;"><div class="fn-label">'+v+"</div></div>");y.push('<div class="row header month" style="width: '+g.getCellSize()*j+'px"><div class="fn-label">'+f.months[I]+"</div></div>");var m=d.dataPanel(k,x.length*g.getCellSize());m.append(z.join(""));m.append(y.join(""));m.append(a('<div class="row" style="margin-left: 0;" />').html(t.join("")));m.append(a('<div class="row" style="margin-left: 0;" />').html(D.join("")));break}return a('<div class="rightPanel"></div>').append(m)},navigation:function(j){var k=null;if(f.navigate==="scroll"){k=a('<div class="navigate" />').append(a('<div class="nav-slider" />').append(a('<div class="nav-slider-left" />').append(a('<button type="button" class="nav-link nav-page-back"/>').html("&lt;").click(function(){d.navigatePage(j,-1)})).append(a('<div class="page-number"/>').append(a("<span/>").html(j.pageNum+1+" of "+j.pageCount))).append(a('<button type="button" class="nav-link nav-page-next"/>').html("&gt;").click(function(){d.navigatePage(j,1)})).append(a('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){d.navigateTo(j,"now")})).append(a('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){if(f.scale==="hours"){d.navigateTo(j,g.getCellSize()*8)}else{if(f.scale==="days"){d.navigateTo(j,g.getCellSize()*30)}else{if(f.scale==="weeks"){d.navigateTo(j,g.getCellSize()*12)}else{if(f.scale==="months"){d.navigateTo(j,g.getCellSize()*6)}}}}})).append(a('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){if(f.scale==="hours"){d.navigateTo(j,g.getCellSize()*4)}else{if(f.scale==="days"){d.navigateTo(j,g.getCellSize()*7)}else{if(f.scale==="weeks"){d.navigateTo(j,g.getCellSize()*4)}else{if(f.scale==="months"){d.navigateTo(j,g.getCellSize()*3)}}}}}))).append(a('<div class="nav-slider-content" />').append(a('<div class="nav-slider-bar" />').append(a('<a class="nav-slider-button" />')).mousedown(function(l){l.preventDefault();j.scrollNavigation.scrollerMouseDown=true;d.sliderScroll(j,l)}).mousemove(function(l){if(j.scrollNavigation.scrollerMouseDown){d.sliderScroll(j,l)}}))).append(a('<div class="nav-slider-right" />').append(a('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){if(f.scale==="hours"){d.navigateTo(j,g.getCellSize()*-4)}else{if(f.scale==="days"){d.navigateTo(j,g.getCellSize()*-7)}else{if(f.scale==="weeks"){d.navigateTo(j,g.getCellSize()*-4)}else{if(f.scale==="months"){d.navigateTo(j,g.getCellSize()*-3)}}}}})).append(a('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){if(f.scale==="hours"){d.navigateTo(j,g.getCellSize()*-8)}else{if(f.scale==="days"){d.navigateTo(j,g.getCellSize()*-30)}else{if(f.scale==="weeks"){d.navigateTo(j,g.getCellSize()*-12)}else{if(f.scale==="months"){d.navigateTo(j,g.getCellSize()*-6)}}}}})).append(a('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){d.zoomInOut(j,-1)})).append(a('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){d.zoomInOut(j,1)}))));a(document).mouseup(function(){j.scrollNavigation.scrollerMouseDown=false})}else{k=a('<div class="navigate" />').append(a('<button type="button" class="nav-link nav-page-back"/>').html("&lt;").click(function(){d.navigatePage(j,-1)})).append(a('<div class="page-number"/>').append(a("<span/>").html(j.pageNum+1+" of "+j.pageCount))).append(a('<button type="button" class="nav-link nav-page-next"/>').html("&gt;").click(function(){d.navigatePage(j,1)})).append(a('<button type="button" class="nav-link nav-begin"/>').html("&#124;&lt;").click(function(){d.navigateTo(j,"begin")})).append(a('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){d.navigateTo(j,g.getCellSize()*7)})).append(a('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){d.navigateTo(j,g.getCellSize())})).append(a('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){d.navigateTo(j,"now")})).append(a('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){d.navigateTo(j,g.getCellSize()*-1)})).append(a('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){d.navigateTo(j,g.getCellSize()*-7)})).append(a('<button type="button" class="nav-link nav-end"/>').html("&gt;&#124;").click(function(){d.navigateTo(j,"end")})).append(a('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){d.zoomInOut(j,-1)})).append(a('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){d.zoomInOut(j,1)}))}return a('<div class="bottom"/>').append(k)},createProgressBar:function(q,j,p,l,k){var m=g.getCellSize();var o=g.getProgressBarMargin()||0;var n=a('<div class="bar"><div class="fn-label">'+l+"</div></div>").addClass(j).css({width:((m*q)-o)+2}).data("dataObj",k);if(p){n.mouseover(function(r){var s=a('<div class="fn-gantt-hint" />').html(p);a("body").append(s);s.css("left",r.pageX);s.css("top",r.pageY);s.show()}).mouseout(function(){a(".fn-gantt-hint").remove()}).mousemove(function(r){a(".fn-gantt-hint").css("left",r.pageX);a(".fn-gantt-hint").css("top",r.pageY+15)})}n.click(function(r){r.stopPropagation();f.onItemClick(a(this).data("dataObj"))});return n},markNow:function(j){switch(f.scale){case"weeks":var k=Date.parse(new Date());k=(Math.floor(k/36400000)*36400000);a(j).find(':findweek("'+k+'")').removeClass("wd").addClass("today");break;case"months":a(j).find(':findmonth("'+new Date().getTime()+'")').removeClass("wd").addClass("today");break;default:var k=Date.parse(new Date());k=(Math.floor(k/36400000)*36400000);a(j).find(':findday("'+k+'")').removeClass("wd").addClass("today");break}},fillData:function(j,k,l){var m=function(r){try{r=r.replace("rgb(","").replace(")","");var t=r.split(",");var p=parseInt(t[0],10);var o=parseInt(t[1],10);var s=parseInt(t[2],10);var n=Math.round((255-(0.299*p+0.587*o+0.114*s))*0.9);return"rgb("+n+", "+n+", "+n+")"}catch(q){return""}};a.each(j.data,function(n,o){if(n>=j.pageNum*f.itemsPerPage&&n<(j.pageNum*f.itemsPerPage+f.itemsPerPage)){a.each(o.values,function(A,B){var F=null;switch(f.scale){case"hours":var G=g.getCellSize()/(3600000*j.scaleStep);var w=g.genId(g.dateDeserialize(B.from).getTime(),j.scaleStep);var D=f.showFractionalHours?(g.dateDeserialize(B.from).getTime()-w)*G:0;var x=a(j).find("#dh-"+w);var u=g.genId(g.dateDeserialize(B.to).getTime(),j.scaleStep);var s=f.showFractionalHours?(g.dateDeserialize(B.to).getTime()-u)*G:0;var q=a(j).find("#dh-"+u);var p=parseInt(x.attr("offset"))+D;var H=parseInt(q.attr("offset"))+s;var z=Math.floor((H-p)/g.getCellSize())+1;F=d.createProgressBar(z,B.customClass?B.customClass:"",B.desc?B.desc:"",B.label?B.label:"",B.dataObj?B.dataObj:null);var r=a(j).find("#rowheader"+n);var v=g.getCellSize()*5+2+parseInt(r.attr("offset"),10);F.css({top:v,left:Math.floor(p)});k.append(F);break;case"weeks":var y=g.dateDeserialize(B.from);var t=g.dateDeserialize(B.to);if(y.getDate()<=3&&y.getMonth()===0){y.setDate(y.getDate()+4)}if(y.getDate()<=3&&y.getMonth()===0){y.setDate(y.getDate()+4)}if(t.getDate()<=3&&t.getMonth()===0){t.setDate(t.getDate()+4)}var x=a(j).find("#"+y.getWeekId());var p=x.attr("offset");var q=a(j).find("#"+t.getWeekId());var H=q.attr("offset");var z=Math.round((H-p)/g.getCellSize())+1;F=d.createProgressBar(z,B.customClass?B.customClass:"",B.desc?B.desc:"",B.label?B.label:"",B.dataObj?B.dataObj:null);var r=a(j).find("#rowheader"+n);var v=g.getCellSize()*3+2+parseInt(r.attr("offset"),10);F.css({top:v,left:Math.floor(p)});k.append(F);break;case"months":var y=g.dateDeserialize(B.from);var t=g.dateDeserialize(B.to);if(y.getDate()<=3&&y.getMonth()===0){y.setDate(y.getDate()+4)}if(y.getDate()<=3&&y.getMonth()===0){y.setDate(y.getDate()+4)}if(t.getDate()<=3&&t.getMonth()===0){t.setDate(t.getDate()+4)}var x=a(j).find("#dh-"+g.genId(y.getTime()));var p=x.attr("offset");var q=a(j).find("#dh-"+g.genId(t.getTime()));var H=q.attr("offset");var z=Math.round((H-p)/g.getCellSize())+1;F=d.createProgressBar(z,B.customClass?B.customClass:"",B.desc?B.desc:"",B.label?B.label:"",B.dataObj?B.dataObj:null);var r=a(j).find("#rowheader"+n);var v=g.getCellSize()*2+2+parseInt(r.attr("offset"),10);F.css({top:v,left:Math.floor(p)});k.append(F);break;default:var w=g.genId(g.dateDeserialize(B.from).getTime());var u=g.genId(g.dateDeserialize(B.to).getTime());var x=a(j).find("#dh-"+w);var p=x.attr("offset");var z=Math.floor(((u/1000)-(w/1000))/86400)+1;F=d.createProgressBar(z,B.customClass?B.customClass:"",B.desc?B.desc:"",B.label?B.label:"",B.dataObj?B.dataObj:null);var r=a(j).find("#rowheader"+n);var v=g.getCellSize()*4+2+parseInt(r.attr("offset"),10);F.css({top:v,left:Math.floor(p)});k.append(F);break}var E=F.find(".fn-label");if(E&&F.length){var C=m(F[0].style.backgroundColor);E.css("color",C)}else{if(E){E.css("color","")}}})}})},navigateTo:function(o,l){var m=a(o).find(".fn-gantt .rightPanel");var j=m.find(".dataPanel");var p=m.width();var n=j.width();switch(l){case"begin":j.animate({"margin-left":"0px"},"fast",function(){d.repositionLabel(o)});o.scrollNavigation.panelMargin=0;break;case"end":var k=n-p;o.scrollNavigation.panelMargin=k*-1;j.animate({"margin-left":"-"+k+"px"},"fast",function(){d.repositionLabel(o)});break;case"now":if(!o.scrollNavigation.canScroll||!j.find(".today").length){return false}var q=(n-p)*-1;var r=j.css("margin-left").replace("px","");var l=j.find(".today").offset().left-j.offset().left;l*=-1;if(l>0){l=0}else{if(l<q){l=q}}j.animate({"margin-left":l+"px"},"fast",d.repositionLabel(o));o.scrollNavigation.panelMargin=l;break;default:var q=(n-p)*-1;var r=j.css("margin-left").replace("px","");var l=parseInt(r,10)+l;if(l<=0&&l>=q){j.animate({"margin-left":l+"px"},"fast",d.repositionLabel(o))}o.scrollNavigation.panelMargin=l;break}},navigatePage:function(j,k){if((j.pageNum+k)>=0&&(j.pageNum+k)<Math.ceil(j.rowsNum/f.itemsPerPage)){d.waitToggle(j,true,function(){j.pageNum+=k;j.hPosition=a(".fn-gantt .dataPanel").css("margin-left").replace("px","");j.scaleOldWidth=false;d.init(j)})}},zoomInOut:function(j,k){d.waitToggle(j,true,function(){var q=(k<0);var o=j.scaleStep+k*3;o=o<=1?1:o===4?3:o;var n=f.scale;var l=j.headerRows;if(f.scale==="hours"&&o>=13){n="days";l=4;o=13}else{if(f.scale==="days"&&q){n="hours";l=5;o=12}else{if(f.scale==="days"&&!q){n="weeks";l=3;o=13}else{if(f.scale==="weeks"&&!q){n="months";l=2;o=14}else{if(f.scale==="weeks"&&q){n="days";l=4;o=13}else{if(f.scale==="months"&&q){n="weeks";l=3;o=13}}}}}}if((q&&a.inArray(n,h)<a.inArray(f.minScale,h))||(!q&&a.inArray(n,h)>a.inArray(f.maxScale,h))){d.init(j);return}j.scaleStep=o;f.scale=n;j.headerRows=l;var m=a(j).find(".fn-gantt .rightPanel");var p=m.find(".dataPanel");j.hPosition=p.css("margin-left").replace("px","");j.scaleOldWidth=(p.width()-m.width());if(f.useCookie){a.cookie(this.cookieKey+"CurrentScale",f.scale);a.cookie(this.cookieKey+"ScrollPos",null)}d.init(j)})},mouseScroll:function(j,k){var o=a(j).find(".fn-gantt .dataPanel");o.css("cursor","move");var m=o.offset();var l=j.scrollNavigation.mouseX===null?k.pageX:j.scrollNavigation.mouseX;var n=k.pageX-l;j.scrollNavigation.mouseX=k.pageX;d.scrollPanel(j,n);clearTimeout(j.scrollNavigation.repositionDelay);j.scrollNavigation.repositionDelay=setTimeout(d.repositionLabel,50,j)},wheelScroll:function(j,k){k.preventDefault();var l=("detail" in k?k.detail:"wheelDelta" in k.originalEvent?-1/120*k.originalEvent.wheelDelta:k.originalEvent.deltaY?k.originalEvent.deltaY/Math.abs(k.originalEvent.deltaY):k.originalEvent.detail);d.scrollPanel(j,-50*l);clearTimeout(j.scrollNavigation.repositionDelay);j.scrollNavigation.repositionDelay=setTimeout(d.repositionLabel,50,j)},sliderScroll:function(o,q){var t=a(o).find(".nav-slider-bar");var s=t.find(".nav-slider-button");var n=a(o).find(".fn-gantt .rightPanel");var k=n.find(".dataPanel");var l=t.offset();var u=t.width();var m=s.width();var r,j;if((q.pageX>=l.left)&&(q.pageX<=l.left+u)){r=q.pageX-l.left;r=r-m/2;s.css("left",r);j=k.width()-n.width();var p=r*j/u*-1;if(p>=0){k.css("margin-left","0px");o.scrollNavigation.panelMargin=0}else{if(r>=u-(m*1)){k.css("margin-left",j*-1+"px");o.scrollNavigation.panelMargin=j*-1}else{k.css("margin-left",p+"px");o.scrollNavigation.panelMargin=p}}clearTimeout(o.scrollNavigation.repositionDelay);o.scrollNavigation.repositionDelay=setTimeout(d.repositionLabel,5,o)}},scrollPanel:function(j,l){if(!j.scrollNavigation.canScroll){return false}var k=parseInt(j.scrollNavigation.panelMargin,10)+l;if(k>0){j.scrollNavigation.panelMargin=0;a(j).find(".fn-gantt .dataPanel").css("margin-left",j.scrollNavigation.panelMargin+"px")}else{if(k<j.scrollNavigation.panelMaxPos*-1){j.scrollNavigation.panelMargin=j.scrollNavigation.panelMaxPos*-1;a(j).find(".fn-gantt .dataPanel").css("margin-left",j.scrollNavigation.panelMargin+"px")}else{j.scrollNavigation.panelMargin=k;a(j).find(".fn-gantt .dataPanel").css("margin-left",j.scrollNavigation.panelMargin+"px")}}d.synchronizeScroller(j)},synchronizeScroller:function(n){if(f.navigate==="scroll"){var m=a(n).find(".fn-gantt .rightPanel");var j=m.find(".dataPanel");var r=a(n).find(".nav-slider-bar");var o=r.find(".nav-slider-button");var s=r.width();var l=o.width();var k=j.width()-m.width();var p=0;if(j.css("margin-left")){p=j.css("margin-left").replace("px","")}var q=p*s/k-o.width()*0.25;q=q>0?0:(q*-1>=s-(l*0.75))?(s-(l*1.25))*-1:q;o.css("left",q*-1)}},repositionLabel:function(j){setTimeout(function(){var l;if(!j){l=a(".fn-gantt .rightPanel .dataPanel")}else{var k=a(j).find(".fn-gantt .rightPanel");l=k.find(".dataPanel")}if(f.useCookie){a.cookie(this.cookieKey+"ScrollPos",l.css("margin-left").replace("px",""))}},500)},waitToggle:function(l,j,n){if(j){var k=a(l).offset();var m=a(l).outerWidth();var o=a(l).outerHeight();if(!l.loader){l.loader=a('<div class="fn-gantt-loader"><div class="fn-gantt-loader-spinner"><span>'+f.waitText+"</span></div></div>")}a(l).append(l.loader);setTimeout(n,500)}else{if(l.loader){l.loader.remove()}l.loader=null}}};var g={getMaxDate:function(j){var m=null;a.each(j.data,function(n,o){a.each(o.values,function(q,p){m=m<g.dateDeserialize(p.to)?g.dateDeserialize(p.to):m})});m=m||new Date();switch(f.scale){case"hours":m.setHours(Math.ceil((m.getHours())/j.scaleStep)*j.scaleStep);m.setHours(m.getHours()+j.scaleStep*3);break;case"weeks":var l=new Date(m.getTime());var l=new Date(l.setDate(l.getDate()+3*7));var k=Math.floor(l.getDate()/7)*7;m=new Date(l.getFullYear(),l.getMonth(),k===0?4:k-3);break;case"months":var l=new Date(m.getFullYear(),m.getMonth(),1);l.setMonth(l.getMonth()+2);m=new Date(l.getFullYear(),l.getMonth(),1);break;default:m.setHours(0);m.setDate(m.getDate()+3);break}return m},getMinDate:function(j){var m=null;a.each(j.data,function(n,o){a.each(o.values,function(q,p){m=m>g.dateDeserialize(p.from)||m===null?g.dateDeserialize(p.from):m})});m=m||new Date();switch(f.scale){case"hours":m.setHours(Math.floor((m.getHours())/j.scaleStep)*j.scaleStep);m.setHours(m.getHours()-j.scaleStep*3);m.setMinutes(0);m.setSeconds(0);m.setMilliseconds(0);break;case"weeks":var l=new Date(m.getTime());var l=new Date(l.setDate(l.getDate()-3*7));var k=Math.floor(l.getDate()/7)*7;m=new Date(l.getFullYear(),l.getMonth(),k===0?4:k-3);break;case"months":var l=new Date(m.getFullYear(),m.getMonth(),1);l.setMonth(l.getMonth()-3);m=new Date(l.getFullYear(),l.getMonth(),1);break;default:m.setHours(0);m.setDate(m.getDate()-3);break}return m},parseDateRange:function(o,n){var m=new Date(o.getTime());var j=new Date(n.getTime());var k=[];var l=0;do{k[l++]=new Date(m.getTime());m.setDate(m.getDate()+1)}while(m.getTime()<=n.getTime());return k},parseTimeRange:function(q,p,l){var o=new Date(q);var k=new Date(p);o.setMilliseconds(0);o.setSeconds(0);o.setMinutes(0);o.setHours(0);k.setMilliseconds(0);k.setSeconds(0);if(k.getMinutes()>0||k.getHours()>0){k.setMinutes(0);k.setHours(0);k.setTime(k.getTime()+(86400000))}var m=[];var n=0;for(;;){var j=new Date(o);j.setHours(Math.floor((o.getHours())/l)*l);if(m[n]&&j.getDay()!==m[n].getDay()){j.setHours(0)}m[n]=j;if(o.getTime()>p.getTime()){break}o=c(j,l);n++}return m},parseWeeksRange:function(o,n){var m=new Date(o);var j=new Date(n);var k=[];var l=0;do{if(m.getDay()===0){k[l++]=m.getDayForWeek()}m.setDate(m.getDate()+1)}while(m.getTime()<=n.getTime());return k},parseMonthsRange:function(o,n){var m=new Date(o);var j=new Date(n);var k=[];var l=0;do{k[l++]=new Date(m.getFullYear(),m.getMonth(),1);m.setMonth(m.getMonth()+1)}while(m.getTime()<=n.getTime());return k},dateDeserialize:function(j){if(typeof j==="string"){j=j.replace(/\/Date\((.*)\)\//,"$1");j=a.isNumeric(j)?parseInt(j,10):a.trim(j)}return new Date(j)},genId:function(o){var n=new Date(o);switch(f.scale){case"hours":var l=n.getHours();if(arguments.length>=2){l=(Math.floor((n.getHours())/arguments[1])*arguments[1])}return(new Date(n.getFullYear(),n.getMonth(),n.getDate(),l)).getTime();case"weeks":var p=n.getFullYear();var k=n.getDayForWeek().getWeekOfYear();var j=n.getMonth();if(j===11&&k===1){p++}return p+"-"+k;case"months":return n.getFullYear()+"-"+n.getMonth();default:return(new Date(n.getFullYear(),n.getMonth(),n.getDate())).getTime()}},_datesToDays:function(n){var m={};for(var l=0,j=n.length,k;l<j;l++){k=g.dateDeserialize(n[l]);m[k.setHours(0,0,0,0)]=true}return m},isHoliday:(function(){if(!f.holidays){return function(){return false}}var j=false;return function(k){if(!j){j=g._datesToDays(f.holidays)}return !!j[a.isNumeric(k)?k:(new Date(k.getFullYear(),k.getMonth(),k.getDate())).getTime()]}})(),_getCellSize:null,getCellSize:function(){if(!g._getCellSize){a("body").append(a('<div style="display: none; position: absolute;" class="fn-gantt" id="measureCellWidth"><div class="row"></div></div>'));g._getCellSize=a("#measureCellWidth .row").height();a("#measureCellWidth").empty().remove()}return g._getCellSize},getRightPanelSize:function(){a("body").append(a('<div style="display: none; position: absolute;" class="fn-gantt" id="measureCellWidth"><div class="rightPanel"></div></div>'));var j=a("#measureCellWidth .rightPanel").height();a("#measureCellWidth").empty().remove();return j},getPageHeight:function(j){return j.pageNum+1===j.pageCount?j.rowsOnLastPage*g.getCellSize():f.itemsPerPage*g.getCellSize()},_getProgressBarMargin:null,getProgressBarMargin:function(){if(!g._getProgressBarMargin&&g._getProgressBarMargin!==0){a("body").append(a('<div style="display: none; position: absolute;" id="measureBarWidth" ><div class="fn-gantt"><div class="rightPanel"><div class="dataPanel"><div class="row day"><div class="bar" /></div></div></div></div></div>'));g._getProgressBarMargin=parseInt(a("#measureBarWidth .fn-gantt .rightPanel .day .bar").css("margin-left").replace("px",""),10);g._getProgressBarMargin+=parseInt(a("#measureBarWidth .fn-gantt .rightPanel .day .bar").css("margin-right").replace("px",""),10);a("#measureBarWidth").empty().remove()}return g._getProgressBarMargin}};this.each(function(){this.data=null;this.pageNum=0;this.pageCount=0;this.rowsOnLastPage=0;this.rowsNum=0;this.hPosition=0;this.dateStart=null;this.dateEnd=null;this.scrollClicked=false;this.scaleOldWidth=null;this.headerRows=null;if(f.useCookie){var j=a.cookie(this.cookieKey+"CurrentScale");if(j){f.scale=a.cookie(this.cookieKey+"CurrentScale")}else{a.cookie(this.cookieKey+"CurrentScale",f.scale)}}switch(f.scale){case"hours":this.headerRows=5;this.scaleStep=1;break;case"weeks":this.headerRows=3;this.scaleStep=13;break;case"months":this.headerRows=2;this.scaleStep=14;break;default:this.headerRows=4;this.scaleStep=13;break}this.scrollNavigation={panelMouseDown:false,scrollerMouseDown:false,mouseX:null,panelMargin:0,repositionDelay:0,panelMaxPos:0,canScroll:true};this.gantt=null;this.loader=null;d.create(this)})}})(jQuery);
